function Controller(n){return function(t){Biba.inject(n,t)}}var Biba=function(){function n(t,i){var r=this;this.router=i;this.router.onRouteFinish(function(t){r.activatedController=n.activateController(t.currentRoute.path=="/"?"":t.currentRoute.path,t.element,r.router)});this.glboalController=t;window.onpopstate=function(n){n.target.history.state&&r.router.route(n.target.history.state.path)}}return n.Start=function(t){HttpClient.request("/app/start",HttpMethod.GET).then(function(i){var u=JSON.parse(i.response),r;t.innerHTML=u.html;n.inject("scope",u.scope);r=new BibaRouter("/");r.initRouterLinks();r.route(location.pathname);new n(n.activateController("*",t,r),r);n.inject("currentRoute",{path:location.pathname})})},n.inject=function(t,i){n._cache[t]=i},n._get=function(t){return n._cache[t]},n.activateController=function(t,i,r){var u=n._get(t),f;return u&&(f=new u(i,r)),f},n._cache={},n}(),UrlUtils;(function(){document.onreadystatechange=function(){document.readyState=="complete"&&Biba.Start(document.getElementsByTagName("app")[0])}})();var ViewController=function(){function n(n){this.element=n;this.scope=Biba._get("scope")}return n}(),BibaRouter=function(){function n(n,t){t===void 0&&(t=document.documentElement);this.rootElement=t;this.baseUrl=n||"/"}return Object.defineProperty(n.prototype,"currentRoute",{get:function(){return Biba._get("currentRoute")},enumerable:!0,configurable:!0}),n.prototype.route=function(t){var i=this;if(t===void 0&&(t=this.baseUrl),t=t||this.baseUrl,!this.currentRoute||t!=this.currentRoute.path)return document.dispatchEvent(new CustomEvent("onRouteStart",{detail:{path:t}})),this.getComponent(t).then(function(r){var f=JSON.parse(r.response),u;return i.routerContainer.innerHTML=f.html,Biba.inject("scope",f.scope),history.pushState({path:t},document.title,t),u=new n(location.pathname,i.routerContainer),u.initRouterLinks()||(u=null,i.initRouterLinks()),i.currentRoute.path=t,document.dispatchEvent(new CustomEvent("onRouteFinish",{detail:{currentRoute:i.currentRoute,element:i.routerContainer}})),r})},n.prototype.initRouterLinks=function(){var t=this,n=!1,i=this.rootElement.querySelector("[router-container]"),r;return i&&(this.routerContainer=i,this.routerContainer.attributes.removeNamedItem("router-container"),n=!0),r=this.rootElement.querySelectorAll("[router-path]"),r.forEach(function(i){var r=i.attributes.getNamedItem("router-path").value;r[0]!="/"&&n&&(r=UrlUtils.join(t.baseUrl,r));i.path=r;i.attributes.removeNamedItem("router-path");t.giveAnchorHandler(i)}),n},n.prototype.giveAnchorHandler=function(n){var t=this;n.onclick=function(n){return t.routerLinkClickHandler(n)}},n.prototype.routerLinkClickHandler=function(n){var t=n.target.path;return this.route(t),!1},n.prototype.getComponent=function(n){return HttpClient.request(("c/"+n).replace("//","/"),HttpMethod.GET)},n.prototype.onRouteStart=function(n){document.addEventListener("onRouteStart",function(t){n(t.detail)},!1)},n.prototype.onRouteFinish=function(n){document.addEventListener("onRouteFinish",function(t){n(t.detail)},!1)},n}(),HttpClient=function(){function n(){}return n.request=function(n,t,i){return new Promise(function(r,u){var f=new XMLHttpRequest;f.open(HttpMethod[t],n,!0);f.onload=function(n){f.status>=200&&f.status<300?r(n.target):u({status:f.status,errorText:f.responseText})};f.onerror=function(){u({status:f.status,errorText:f.responseText})};f.send(i?i.data:null)})},n}(),HttpMethod;(function(n){n[n.GET=0]="GET";n[n.POST=1]="POST";n[n.PUT=2]="PUT";n[n.PATCH=3]="PATCH";n[n.DELETE=4]="DELETE";n[n.OPTIONS=5]="OPTIONS";n[n.HEAD=6]="HEAD";n[n.TRACE=7]="TRACE";n[n.CONNECT=8]="CONNECT"})(HttpMethod||(HttpMethod={}));UrlUtils=function(){function n(){}return n.join=function(){for(var t,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];return t=[],Array.prototype.slice.call(arguments).forEach(function(n){var i=n.split("/");i.forEach(function(n){n&&t.push(n.match(/[\w$-_.+!*'()]+/))})}),t.join("/")},n}();