<!DOCTYPE html>
<html>

<head>
<script>
class BibaRouter {
    constructor() {
        this.noop = () => { };
        document.addEventListener('DOMContentLoaded', () => this.initRouterLinks());
        this.onRouteStart = this.noop;
        this.onRouteFinish = this.noop;
    }
    initRouterLinks() {
        var routerLinks = [];
        var allElements = Array.prototype.slice.call(document.body.getElementsByTagName('*'));
        for (var item of allElements) {
            var attr = item.attributes.getNamedItem('router-path');
            if (attr) {
                routerLinks.push(item);
            }
            else if (item.attributes.getNamedItem('router-container')) {
                this.routerContainer = item;
                this.routerContainer.attributes.removeNamedItem('router-container');
            }
        }
        for (var routerLink of routerLinks) {
            var newLinkContainer = document.createElement('a');
            newLinkContainer.innerHTML = routerLink.innerHTML;
            newLinkContainer.href = routerLink.attributes.getNamedItem('router-path').value;
            this.giveAnchorHandler(newLinkContainer);
            routerLink.parentElement.insertBefore(newLinkContainer, routerLink);
            routerLink.parentElement.removeChild(routerLink);
        }
        if (this.routerContainer) {
            this.getComponent(location.pathname).then((template) => {
                this.routerContainer.innerHTML = template;
            });
        }
        return {};
    }
    giveAnchorHandler(el) {
        el.onclick = (e) => this.routerLinkClickHandler(e);
    }
    routerLinkClickHandler(event) {
        let componentPath = event.target.attributes.getNamedItem('href').value;
        this.onRouteStart(this.currentRoute, { path: componentPath }, this);
        this.getComponent(componentPath).then(template => {
            this.routerContainer.innerHTML = template;
            history.pushState({}, document.title, componentPath);
            this.currentRoute = { path: componentPath };
            this.onRouteFinish({}, this.currentRoute, this);
        }).catch(console.error);
        return false;
    }
    getComponent(path, data) {
        return new Promise((resolve, reject) => {
            let req = new XMLHttpRequest();
            let newPath = `c/${path}`.replace('//', '/');
            req.open('POST', newPath, true);
            req.onload = (event) => {
                resolve(event.target.response);
            };
            req.onerror = (event) => {
                reject(event);
            };
            req.send(data || null);
        });
    }
}
new BibaRouter();
</script>

    <meta charset="utf-8">
    <base href="/">
    <title>Biba main</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <row>
            <div class="col">
                <h1>Hello from BibaViewEngine</h1>
                <a router-path="">Main</a>
                <a router-path="list">List</a>
                <hr>
            </div>
        </row>
        <row>
            <div class="col">
                <app config="{}"></app>
            </div>
        </row>

        <hr>

        <footer>
            Â© 2017 BibaViewEngine
        </footer>
    </div>

    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
</body>

</html>